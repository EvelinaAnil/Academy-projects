TcpListener - класс

Ожидает подключения от TCP-клиентов сети.

Пространство имен:  System.Net.Sockets
Сборка:  System (в System.dll)

Синтаксис
public class TcpListener

Тип TcpListener предоставляет следующие члены.

Конструкторы
 TcpListener	Перегружен. Выполняет инициализацию нового экземпляра класса TcpListener.

Методы
 AcceptSocket	Принимает ожидающий запрос на подключение.
 AcceptTcpClient	Принимает ожидающий запрос на подключение
 BeginAcceptSocket	Начинает асинхронную операцию, чтобы принять попытку входящего подключения.
 BeginAcceptTcpClient	Начинает асинхронную операцию, чтобы принять попытку входящего подключения.
 EndAcceptSocket	Асинхронно принимает входящие попытки подключения и создает новый объект Socket для связи с удаленным узлом.
 EndAcceptTcpClient	Асинхронно принимает входящие попытки подключения и создает новый объект TcpClient для связи с удаленным узлом.
 Equals	Определяет, равен ли заданный объект Object текущему объекту Object. (Унаследовано от Object.)
 Finalize	Перегружен.
 GetHashCode	Играет роль хэш-функции для определенного типа. (Унаследовано от Object.)
 GetType	Возвращает объект Type для текущего экземпляра. (Унаследовано от Object.)
 MemberwiseClone	Создает неполную копию текущего объекта Object. (Унаследовано от Object.)
 Pending	Определяет, имеются ли ожидающие запросы на подключение.
 Start	Перегружен. Запускает ожидание входящих запросов на подключение.
 Stop	Закрывает слушатель.
 ToString	Возвращает объект String, который представляет текущий объект Object. (Унаследовано от Object.)

Свойства
 Active	Получает значение, указывающее, является ли активным объект TcpListener, выполняющий прослушивание клиентских подключений.
 ExclusiveAddressUse	Возвращает или задает значение Boolean, указывающее, позволяет ли объект TcpListener осуществлять ожидание передачи данных только на одном основном сокете на указанном порту.
 LocalEndpoint	Получает основной объект EndPoint для текущего объекта TcpListener.
 Server	Получает основной сетевой объект Socket.

Заметки
Класс TcpListener предоставляет простые методы, предназначенные для ожидания и приема в блокирующем синхронном режиме входящих запросов на подключения. Можно использовать объект TcpClient или Socket, чтобы подключиться к объекту TcpListener. Создайте объект TcpListener, используя объект IPEndPoint, локальный IP-адрес и номер локального порта или же только номер порта. Задайте значение Any для локального IP-адреса и значение 0 для номера локального порта, если необходимо, чтобы эти значения были присвоены основным поставщиком услуг. Если выбран этот вариант, можно воспользоваться свойством LocalEndpoint, чтобы определить присвоенные параметры после подключения сокета.
Используйте метод Start, чтобы начать ожидание входящих запросов на подключение. Метод Start будет ставить в очередь входящие подключения до тех пор, пока не будет вызван метод Stop или в очередь не будет поставлено количество запросов, заданное параметром MaxConnections. Используйте для принятия подключения из входной очереди подключений метод AcceptSocket или AcceptTcpClient. Эти два метода будут выполнять блокирование. Если необходимо избежать блокирования, воспользуйтесь сначала методом Pending для того, чтобы определить, имеются ли в очереди доступные запросы на подключение.
Вызовите метод Stop, чтобы закрыть объект TcpListener.

Примечание.
Метод Stop не закрывает никакие принятые подключения. Пользователь сам несет ответственность за закрытие каждого из этих подключений.

Примеры
В следующем примере программы создается объект TcpListener.

using System;
using System.IO;
using System.Net;
using System.Net.Sockets;
using System.Text;

class MyTcpListener
{
  public static void Main()
  { 
    TcpListener server=null;   
    try
    {
      // Set the TcpListener on port 13000.
      Int32 port = 13000;
      IPAddress localAddr = IPAddress.Parse("127.0.0.1");

      // TcpListener server = new TcpListener(port);
      server = new TcpListener(localAddr, port);

      // Start listening for client requests.
      server.Start();

      // Buffer for reading data
      Byte[] bytes = new Byte[256];
      String data = null;

      // Enter the listening loop.
      while(true) 
      {
        Console.Write("Waiting for a connection... ");

        // Perform a blocking call to accept requests.
        // You could also user server.AcceptSocket() here.
        TcpClient client = server.AcceptTcpClient();            
        Console.WriteLine("Connected!");

        data = null;

        // Get a stream object for reading and writing
        NetworkStream stream = client.GetStream();

        int i;

        // Loop to receive all the data sent by the client.
        while((i = stream.Read(bytes, 0, bytes.Length))!=0) 
        {   
          // Translate data bytes to a ASCII string.
          data = System.Text.Encoding.ASCII.GetString(bytes, 0, i);
          Console.WriteLine("Received: {0}", data);

          // Process the data sent by the client.
          data = data.ToUpper();

          byte[] msg = System.Text.Encoding.ASCII.GetBytes(data);

          // Send back a response.
          stream.Write(msg, 0, msg.Length);
          Console.WriteLine("Sent: {0}", data);            
        }

        // Shutdown and end connection
        client.Close();
      }
    }
    catch(SocketException e)
    {
      Console.WriteLine("SocketException: {0}", e);
    }
    finally
    {
       // Stop listening for new clients.
       server.Stop();
    }

    Console.WriteLine("\nHit enter to continue...");
    Console.Read();
  }   
}